# Ceph 基本配置

官方教程：https://ceph.readthedocs.io/en/latest/rados/configuration/ceph-conf/

Ceph 集群中运行的守护进程包括：**Ceph Monitor**（ceph-mon）、**Ceph Manager**（ceph-mgr）、**Ceph OSD Daemon**（ceph-osd）。

如果要运行 Ceph 分布式文件系统，还要加一个 **Ceph Metadata Server**（ceph-mds）守护进程。

如果要支持一些对象储存的接口，比如 S3 API，还需要支持 radosgw

每个守护程序都有一系列配置选项，每个配置选项都有一个默认值。您可以通过更改这些配置选项来调整系统的行为。



## 配置名称

所有Ceph配置选项都有一个唯一的名称，该名称由用小写字母组成的单词和下划线（_）组成。

在命令行上指定选项名称时，下划线（_）或破折号（-）字符可以互换使用（例如--mon-host等效于--mon_host）。

当配置选项名称出现在配置文件中时，也可以使用空格代替下划线或破折号！！！



## 配置源

每个Ceph守护进程，进程和库都将从以下列出的几个来源中提取其配置。如果同时存在，则列表后面的源将覆盖列表前面的源：

- 默认值
- Monitor 集群的集中配置数据库
- 存储在本地主机上的配置文件，比如 /etc/ceph/ceph.conf
- 环境变量
- 命令行参数
- 管理员设置的运行时替代

Ceph进程在启动时要做的第一件事之一就是解析通过命令行，环境和本地配置文件提供的配置选项。然后，该过程将与 Monitor 集群联系，以检索整个集群集中存储的配置。一旦可获得完整的配置视图，则将继续执行守护程序或进程。



#### 启动选项

由于某些配置选项会影响进程与 Monitor 联系，进行身份验证和检索集群存储的配置的能力，因此需要将它们本地存储在节点上并在本地配置文件中进行设置。这些选项包括：

- `mon_host` 配置集群的 monitors 列表
- `mon_dns_serv_name` （默认 *ceph-mon*）DNS SRV记录的名称，以检查以通过DNS识别集群监视器
- `mon_data`, `osd_data`, `mds_data`, `mgr_data` 以及定义守护程序将数据存储在哪个本地目录中的类似选项。
- `keyring`, `keyfile` 或者是 `key` 可以用来指定用于与 monitors 进行身份验证的身份验证凭据。请注意，在大多数情况下，默认密钥环位置在上面指定的数据目录中。

在大多数情况下，这些默认值都是合适的，但 `mon_host` 选项除外，该选项标识群集的 Monitor 的地址。使用 DNS 标识 Monitor 时，可以完全避免使用本地ceph配置文件。



#### 跳过从 Monitor 中获取配置

可以通过--no-mon-config选项传递给任何进程，以跳过从集群监视器检索配置的步骤。在完全通过配置文件管理配置或 Monitor 群集当前已关闭但需要完成一些维护活动的情况下，这很有用。



## 配置段

对于每个配置选项，任何给定的进程或守护程序都有一个值。但是，选项的值可能会在不同的守护程序类型之间变化，甚至是同一类型的守护程序也可能不同。存储在 Monitor 配置数据库或本地配置文件中的Ceph选项分为几部分，以指示它们适用于哪些守护程序或客户端。

所有的段有：

- global：全局下的设置会影响Ceph存储群集中的所有守护程序和客户端。
- mon：mon下的设置会影响Ceph存储群集中的所有ceph-mon守护程序，并覆盖global中的相同设置。
- mgr：mgr部分中的设置会影响Ceph Storage Cluster中的所有ceph-mgr守护程序，并覆盖global中的相同设置。
- osd：osd下的设置会影响Ceph Storage Cluster中的所有ceph-osd守护进程，并覆盖global中的相同设置。
- mds：mds部分中的设置会影响Ceph存储群集中的所有ceph-mds守护程序，并覆盖global中的相同设置。
- client：客户端下的设置会影响所有Ceph客户端（例如已安装的Ceph文件系统，已安装的Ceph块设备等）以及Rados Gateway（RGW）守护程序。

部分还可以指定单个守护程序或客户端名称。例如，mon.foo，osd.123和client.smith都是有效的节名称。

任何给定的守护程序都将从全局部分，守护程序或客户机类型部分以及共享其名称的部分中获取其设置。最具体部分中的设置优先，因此例如，如果在同一源（即，在同一配置文件中）的global，mon和mon.foo中都指定了相同的选项，则将使用mon.foo值。

如果在同一部分中指定了同一配置选项的多个值，则以最后一个值为准。

请注意，本地配置文件中的值始终优先于监视器配置数据库中的值，而不管它们出现在哪个部分中。















