# 指标聚合

指标聚合，即 Metrics Aggregations，这类聚合使用的源数据是文档中的数据，比如文档中有一个字段记录的是年龄，那么就可以通过指标聚合来计算最小年龄、最大年龄、平均年龄等信息。

指标聚合也分很多种，大约 20 种左右，下面依次来学习一下



## Avg

求平均数超级简单：

```http
POST /race-for-president-2016/_search
{
  "size": 0,
  "aggs": {
    "avg_line": {
      "avg": {
        "field": "Line"
      }
    }
  }
}
```

或者使用脚本：

```http
POST /race-for-president-2016/_search
{
  "size": 0,
  "aggs": {
    "avg_line": {
      "avg": {
         "script": {
           "source": "doc.Line.value"
         }
      }
    }
  }
}
```

在脚本中对平均数做计算：

````http
POST /race-for-president-2016/_search
{
  "size": 0,
  "aggs": {
    "avg_line": {
      "avg": {
         "script": {
           "source": "doc.Line.value * 2"
         }
      }
    }
  }
}
````

也可以将 2 设置为变量：

```http
POST /race-for-president-2016/_search
{
  "size": 0,
  "aggs": {
    "avg_line": {
      "avg": {
         "field": "Line", 
         "script": {
           "lang": "painless",
           "source": "_value * params.a",
           "params": {
             "a": 2
           }
         }
      }
    }
  }
}
```

有的文档中，值会不存在，默认会忽略掉不存在的值，但是有时候会想设置另外的默认值，可以这样子：

```http
POST /race-for-president-2016/_search
{
  "size": 0,
  "aggs": {
    "avg_line": {
      "avg": {
        "field": "Line",
        "missing": 10 
      }
    }
  }
}
```















